# Visualization Module

## 概要

BCISystem Visualization Moduleは、脳波データのリアルタイム可視化と解析結果の表示を行うためのコンポーネント群です。このモジュールは、生データの表示から高度な時間-周波数解析の可視化まで、幅広い可視化機能を提供します。

## 主要機能

### 1. リアルタイムデータ表示
- 生脳波データの波形表示
- 処理済み脳波データの波形表示
- マルチチャンネル同時表示
- スケーリング機能（自動/手動）

### 2. スペクトル解析表示
- パワースペクトル密度プロット
- 周波数帯域（δ, θ, α, β, γ）の視覚的表示
- 時間-周波数解析（ERSP）の2次元マッピング

### 3. コントロールインターフェース
- 収録開始/停止/一時停止ボタン
- オンライン/オフラインモード切替
- パラメータ調整パネル
- トリガーマーカー設定

## アーキテクチャ

### GUIControllerManager
メインのGUIコントローラークラスで、以下の機能を提供します：

1. 表示パネル管理
   - メインフィグュアウィンドウの作成
   - サブプロットの配置と管理
   - 表示更新タイマーの制御

2. ユーザー入力処理
   - ボタンイベントのハンドリング
   - パラメータ入力の検証
   - スライダーコントロール

3. データ表示更新
   - リアルタイムプロット更新
   - スケーリング処理
   - カラーマップ管理

## 使用方法

### 基本的な初期化
```matlab
% パラメータの読み込み
params = getConfig('epocx');

% GUIコントローラーの初期化
guiController = GUIControllerManager(params);

% コールバックの設定
callbacks = struct(...
    'onStart', @startCallback, ...
    'onStop', @stopCallback, ...
    'onPause', @pauseCallback, ...
    'onModeChange', @modeChangeCallback, ...
    'onLabel', @labelCallback);
guiController.setCallbacks(callbacks);
```

### データの表示更新
```matlab
% 表示データの構造体作成
displayData = struct(...
    'rawData', rawData, ...
    'processedData', processedData, ...
    'spectrum', spectrumData, ...
    'ersp', erspData);

% 表示の更新
guiController.updateDisplayData(displayData);
```

## パラメータ設定

### 表示設定
```matlab
params.gui.display.visualization = struct(...
    'refreshRate', 0.2, ...          % 表示更新レート（秒）
    'enable', struct(...             % 表示項目の有効/無効
        'rawData', true, ...
        'processedData', true, ...
        'spectrum', true, ...
        'ersp', true ...
    ), ...
    'scale', struct(...              % スケール設定
        'auto', true, ...            % 自動スケーリング
        'raw', [-100 100], ...       % 生データ表示範囲
        'processed', [-50 50], ...   % 処理済データ表示範囲
        'freq', [0 50], ...          % 周波数表示範囲
        'power', [0 100] ...         % パワー表示範囲
    )
);
```

### ERSP表示設定
```matlab
params.gui.display.visualization.ersp = struct(...
    'scale', [-3 3], ...            % 表示スケール（dB）
    'time', [-1 5], ...             % 時間範囲（秒）
    'freqRange', [1 50], ...        % 周波数範囲（Hz）
    'colormap', struct(...          % カラーマップ設定
        'type', 'jet', ...
        'reverse', false, ...
        'background', 'white' ...
    )
);
```

## エラーハンドリング

### エラー表示
```matlab
% エラーダイアログの表示
guiController.showError('エラータイトル', 'エラーメッセージ');
```

### ステータス更新
```matlab
% 状態表示の更新
guiController.updateStatus('Recording');
```

## トラブルシューティング

### よくある問題と解決方法

1. 表示が更新されない
   - 更新レートの確認
   - タイマーの状態確認
   - メモリ使用量の確認

2. プロットが見切れる
   - スケーリング設定の確認
   - ウィンドウサイズの調整
   - 自動スケーリングの有効化

3. パフォーマンスの問題
   - 表示更新レートの調整
   - 表示データ量の最適化
   - 不要な表示項目の無効化

## 制限事項

1. メモリ使用
   - 長時間の記録時はメモリ使用量に注意
   - 定期的なデータクリアを推奨

2. 表示性能
   - 高サンプリングレートでの表示は負荷が高い
   - 必要に応じて間引き表示を検討

3. マルチディスプレイ
   - デュアルディスプレイ環境での動作は保証外
   - プライマリディスプレイでの使用を推奨

## ベストプラクティス

1. データ表示
   - 重要なチャンネルのみを表示
   - 適切なスケーリングの使用
   - カラーマップの最適化

2. パフォーマンス
   - 必要最小限の更新レート設定
   - 不要な表示機能の無効化
   - 定期的なメモリクリア

3. エラー処理
   - エラーログの活用
   - 適切なエラーメッセージの表示
   - ユーザーへのフィードバック

## 貢献ガイドライン

1. コード規約
   - MATLABコーディング規約に準拠
   - 適切なコメントの記述
   - 明確な変数名の使用

2. テスト
   - 新機能追加時のテスト実施
   - 異常系のテスト
   - パフォーマンステスト

3. ドキュメント
   - 機能の詳細な記述
   - 使用例の提供
   - 更新履歴の管理

## バージョン履歴

### v1.0.0 (2024-01-01)
- 初期リリース
- 基本的な可視化機能の実装
- GUIコントローラーの実装

### v1.1.0 (2024-02-01)
- ERSPプロットの追加
- パフォーマンスの最適化
- バグ修正

## ライセンス

このモジュールは[ライセンス名]のもとで公開されています。詳細については`LICENSE`ファイルを参照してください。

## 連絡先

- 開発者: [開発者名]
- メール: [メールアドレス]
- プロジェクトURL: [URL]